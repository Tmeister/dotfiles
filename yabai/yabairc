#!/usr/bin/env sh

#
# for this to work you must configure sudo such that
# it will be able to run the command without password
#
# see this wiki page for information:
#  - https://github.com/koekeishiya/yabai/wiki/Installing-yabai-(latest-release)#configure-scripting-addition
#

# Load scripting addition
sudo yabai --load-sa
yabai -m signal --add event=dock_did_restart action="sudo yabai --load-sa"

# global settings
yabai -m config \
  menubar_opacity 1.0 \
  mouse_follows_focus off \
  focus_follows_mouse off \
  display_arrangement_order default \
  window_origin_display default \
  window_placement second_child \
  window_insertion_point focused \
  window_zoom_persist on \
  window_shadow on \
  window_animation_duration 0.0 \
  window_animation_easing ease_out_circ \
  window_opacity_duration 0.0 \
  active_window_opacity 1.0 \
  normal_window_opacity 0.90 \
  window_opacity off \
  insert_feedback_color 0xffd75f5f \
  split_ratio 0.50 \
  split_type auto \
  auto_balance off \
  top_padding 56 bottom_padding 16 \
  left_padding 16 \
  right_padding 16 \
  window_gap 16 \
  layout bsp \
  mouse_modifier fn \
  mouse_action1 move \
  mouse_action2 resize \
  mouse_drop_action swap

# Label existing spaces (create them manually in Mission Control if needed)
yabai -m space 1 --label Web 2>/dev/null
yabai -m space 2 --label Dev 2>/dev/null
yabai -m space 3 --label Chat 2>/dev/null
yabai -m space 4 --label DB 2>/dev/null
yabai -m space 5 --label Arc 2>/dev/null
yabai -m space 6 --label Misc 2>/dev/null
yabai -m space 7 --label Tools 2>/dev/null
yabai -m space 8 --label Media 2>/dev/null
yabai -m space 9 --label Acquira 2>/dev/null

# Space 1: Default Browser (Dia)
yabai -m rule --add app="^Dia$" space=^1

# Space 2: Terminal (Ghostty)
yabai -m rule --add app="^Ghostty$" space=^2
yabai -m rule --add app="^ghostty$" space=^2

# Space 3: Slack
yabai -m rule --add app="^Slack$" space=^3

# Space 4: TablePlus
yabai -m rule --add app="^TablePlus$" space=^4

# Space 5: Arc
yabai -m rule --add app="^Arc$" space=^5

# Space 8: Media apps
yabai -m rule --add app="^Spotify$" space=^8

# Space 10: Google Chrome (Second monitor)
yabai -m rule --add app="^Google Chrome$" space=^10

# Floating apps - System utilities
yabai -m rule --add app="^System Settings$" manage=off
yabai -m rule --add app="^System Preferences$" manage=off
yabai -m rule --add app="^System Information$" manage=off
yabai -m rule --add app="^Activity Monitor$" manage=off
yabai -m rule --add app="^Console$" manage=off
yabai -m rule --add app="^Keychain Access$" manage=off
yabai -m rule --add app="^Migration Assistant$" manage=off
yabai -m rule --add app="^Screenshot$" manage=off
yabai -m rule --add app="^ColorSync Utility$" manage=off
yabai -m rule --add app="^Digital Color Meter$" manage=off
yabai -m rule --add app="^Disk Utility$" manage=off

# Floating apps - macOS apps
yabai -m rule --add app="^Calculator$" manage=off
yabai -m rule --add app="^Calendar$" manage=off
yabai -m rule --add app="^Contacts$" manage=off
yabai -m rule --add app="^Dictionary$" manage=off
yabai -m rule --add app="^Notes$" manage=off
yabai -m rule --add app="^Reminders$" manage=off
yabai -m rule --add app="^Clock$" manage=off
yabai -m rule --add app="^Weather$" manage=off
yabai -m rule --add app="^Stocks$" manage=off
yabai -m rule --add app="^Home$" manage=off
yabai -m rule --add app="^News$" manage=off
yabai -m rule --add app="^Shortcuts$" manage=off
yabai -m rule --add app="^Tips$" manage=off
yabai -m rule --add app="^Freeform$" manage=off
yabai -m rule --add app="^Stickies$" manage=off
yabai -m rule --add app="^Photo Booth$" manage=off
yabai -m rule --add app="^Font Book$" manage=off
yabai -m rule --add app="^Image Capture$" manage=off

# Floating apps - Third party utilities
yabai -m rule --add app="^Numi$" manage=off
yabai -m rule --add app="^1Password$" manage=off
yabai -m rule --add app="^DeepL$" manage=off
yabai -m rule --add app="^GPG Keychain$" manage=off
yabai -m rule --add app="^Grammarly Desktop$" manage=off
yabai -m rule --add app="^Hidden Bar$" manage=off
yabai -m rule --add app="^KeyCastr$" manage=off
yabai -m rule --add app="^Karabiner-Elements$" manage=off
yabai -m rule --add app="^Karabiner-EventViewer$" manage=off
yabai -m rule --add app="^DisplayLink Manager$" manage=off
yabai -m rule --add app="^logioptionsplus$" manage=off
yabai -m rule --add app="^ImageOptim$" manage=off
yabai -m rule --add app="^Raycast$" manage=off
yabai -m rule --add app="^Alfred$" manage=off
yabai -m rule --add app="^Ãœbersicht$" manage=off

# Floating apps - Installers and updaters
yabai -m rule --add app="^Installer$" manage=off
yabai -m rule --add app="^Software Update$" manage=off
yabai -m rule --add title="^Opening" manage=off
yabai -m rule --add title="^Updating" manage=off
yabai -m rule --add title="^Preferences$" manage=off
yabai -m rule --add title="^Settings$" manage=off

# Float all child windows and dialogs
yabai -m rule --add subrole="^AXDialog$" manage=off
yabai -m rule --add subrole="^AXFloatingWindow$" manage=off
yabai -m rule --add subrole="^AXSystemDialog$" manage=off
yabai -m rule --add subrole="^AXSheet$" manage=off

# Float common dialog patterns
yabai -m rule --add title="^(Open|Save|Print|Export|Import|Share)$" manage=off
yabai -m rule --add title="^(Preferences|Settings|Options|Configuration)$" manage=off
yabai -m rule --add title="^(About|Info|Inspector|Properties)$" manage=off
yabai -m rule --add title="^(Select|Choose|Pick)" manage=off
yabai -m rule --add title="(Copy|Move|Delete|Rename)" manage=off
yabai -m rule --add title="^(Alert|Warning|Error|Confirm)" manage=off

# PHPStorm specific rules (must come before general rules)
yabai -m rule --add app="^PhpStorm$" title="^Welcome to PhpStorm$" manage=on
yabai -m rule --add app="^PhpStorm$" title="^Open Project$" manage=on
yabai -m rule --add app="^PhpStorm$" title=".*" manage=on  # All PHPStorm windows are tiled by default
yabai -m rule --add app="^PhpStorm$" subrole="^AXDialog$" manage=off  # Except dialogs
yabai -m rule --add app="^PhpStorm$" subrole="^AXFloatingWindow$" manage=off  # And floating windows

# Float windows that are typically small
yabai -m rule --add app=".*" title="^$" manage=off  # Windows with no title

# IntelliJ-based IDEs (WebStorm, PyCharm, etc.)
yabai -m rule --add app="^(IntelliJ IDEA|WebStorm|PyCharm|RubyMine|GoLand|CLion|Rider|DataGrip)$" title="^Welcome to" manage=on
yabai -m rule --add app="^(IntelliJ IDEA|WebStorm|PyCharm|RubyMine|GoLand|CLion|Rider|DataGrip)$" title="^Open Project$" manage=on

# Float specific problematic child windows
yabai -m rule --add app="^Finder$" title="(Copy|Move|Delete|Info|Connect)" manage=off
yabai -m rule --add app="^Safari$" title="^(Downloads|Develop|Bookmarks|History)$" manage=off
yabai -m rule --add app="^System Preferences$" manage=off
yabai -m rule --add app="^Archive Utility$" manage=off

echo "yabai configuration loaded.."
